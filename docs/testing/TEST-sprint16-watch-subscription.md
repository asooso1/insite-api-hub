# Sprint 16 테스트 체크리스트 - Watch 구독 기능

**작성일**: 2026-02-03
**테스트 환경**: http://localhost:3005

---

## 1. DB 스키마 확인

### 1.1 endpoint_watchers 테이블 생성

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 1 | 테이블 존재 확인 | psql 접속 후 `\dt endpoint_watchers` | endpoint_watchers 테이블 존재 | [ ] |
| 2 | 스키마 구조 확인 | `\d endpoint_watchers` | id, endpoint_id, user_id, created_at 컬럼 확인 | [ ] |
| 3 | UNIQUE 제약 확인 | 스키마 확인 | (endpoint_id, user_id) UNIQUE 제약 존재 | [ ] |
| 4 | 외래키 확인 | 스키마 확인 | endpoints(id), users(id) 외래키 설정됨 | [ ] |

---

## 2. 서버 액션 테스트

### 2.1 watchEndpoint 액션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 5 | 최초 구독 | 구독하지 않은 엔드포인트 구독 | success: true, DB에 레코드 생성 | [ ] |
| 6 | 중복 구독 방지 | 같은 엔드포인트 재구독 | 에러 없이 처리 (ON CONFLICT 동작) | [ ] |
| 7 | 유효하지 않은 ID | 존재하지 않는 endpoint_id로 구독 시도 | 외래키 에러 발생 | [ ] |

### 2.2 unwatchEndpoint 액션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 8 | 구독 해제 | 구독 중인 엔드포인트 해제 | success: true, DB 레코드 삭제 | [ ] |
| 9 | 미구독 해제 | 구독하지 않은 엔드포인트 해제 | 에러 없이 처리 | [ ] |

### 2.3 isWatching 액션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 10 | 구독 중 확인 | 구독 중인 엔드포인트 확인 | true 반환 | [ ] |
| 11 | 미구독 확인 | 구독하지 않은 엔드포인트 확인 | false 반환 | [ ] |

### 2.4 getWatchers 액션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 12 | 구독자 목록 조회 | 특정 엔드포인트의 구독자 조회 | 구독자 목록 (user_name, email 포함) 반환 | [ ] |
| 13 | 빈 구독자 | 구독자 없는 엔드포인트 조회 | 빈 배열 반환 | [ ] |

### 2.5 getWatchedEndpoints 액션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 14 | 구독 엔드포인트 조회 | 특정 사용자가 구독 중인 엔드포인트 조회 | 구독 엔드포인트 목록 (path, method 포함) 반환 | [ ] |
| 15 | 빈 구독 목록 | 아무것도 구독하지 않은 사용자 조회 | 빈 배열 반환 | [ ] |

### 2.6 toggleWatch 액션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 16 | 토글 구독 → 해제 | 구독 중 → toggleWatch | 구독 해제 (unwatchEndpoint 호출) | [ ] |
| 17 | 토글 해제 → 구독 | 미구독 → toggleWatch | 구독 (watchEndpoint 호출) | [ ] |

---

## 3. UI 컴포넌트 테스트

### 3.1 WatchButton 렌더링

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 18 | 버튼 표시 확인 | ApiList에서 엔드포인트 카드 확인 | 우측에 Watch 버튼 표시 | [ ] |
| 19 | 로그인 필요 | 비로그인 상태 확인 | WatchButton 표시 안됨 (userId 없음) | [ ] |
| 20 | 아이콘 변경 (구독) | 구독 중인 엔드포인트 | Eye 아이콘 (노란색) 표시 | [ ] |
| 21 | 아이콘 변경 (미구독) | 미구독 엔드포인트 | EyeOff 아이콘 (회색) 표시 | [ ] |

### 3.2 WatchButton 인터랙션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 22 | 구독 클릭 | 미구독 → 버튼 클릭 | Eye 아이콘으로 변경, 구독 완료 | [ ] |
| 23 | 해제 클릭 | 구독 중 → 버튼 클릭 | EyeOff 아이콘으로 변경, 구독 해제 | [ ] |
| 24 | 로딩 상태 | 버튼 클릭 후 응답 전 | disabled 상태, 투명도 감소 | [ ] |
| 25 | 이벤트 전파 방지 | 버튼 클릭 | 카드 확장/축소 동작 안됨 | [ ] |

### 3.3 WatchButton 애니메이션

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 26 | Hover 효과 | 버튼에 마우스 오버 | scale: 1.05 애니메이션 | [ ] |
| 27 | Tap 효과 | 버튼 클릭 | scale: 0.95 애니메이션 | [ ] |
| 28 | 아이콘 전환 애니메이션 | 구독/해제 시 | 아이콘 페이드인/아웃 효과 | [ ] |

### 3.4 WatchButton 툴팁

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 29 | 구독 툴팁 | 미구독 상태 호버 | "알림 받기" 툴팁 표시 | [ ] |
| 30 | 해제 툴팁 | 구독 상태 호버 | "알림 중지" 툴팁 표시 | [ ] |

---

## 4. ApiList 통합 테스트

### 4.1 레이아웃

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 31 | 버튼 위치 | 엔드포인트 카드 확인 | 헤더 우측, 담당자 앞에 배치 | [ ] |
| 32 | 컴팩트 모드 | compact={true} 확인 | 아이콘만 표시 (텍스트 없음) | [ ] |
| 33 | 반응형 | 모바일 화면 확인 | 버튼 크기 적절히 축소 | [ ] |

### 4.2 세션 정보 전달

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 34 | userId 전달 | 로그인 후 확인 | userId prop 올바르게 전달 | [ ] |
| 35 | 엔드포인트 ID 전달 | 버튼 클릭 시 확인 | 올바른 endpointId로 액션 호출 | [ ] |

---

## 5. 다크모드 지원

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 36 | 라이트 모드 색상 | 라이트 모드에서 확인 | 밝은 배경, 어두운 아이콘 | [ ] |
| 37 | 다크 모드 색상 | 다크 모드에서 확인 | 어두운 배경, 밝은 아이콘 | [ ] |
| 38 | 구독 상태 강조 (Light) | 라이트 모드에서 구독 중 | amber-600 색상 강조 | [ ] |
| 39 | 구독 상태 강조 (Dark) | 다크 모드에서 구독 중 | amber-400 색상 강조 | [ ] |

---

## 6. 에러 처리

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 40 | 네트워크 에러 | 네트워크 끊고 버튼 클릭 | "오류가 발생했습니다" 알림 | [ ] |
| 41 | 로그인 필요 알림 | userId 없이 버튼 클릭 | "로그인이 필요합니다" 알림 | [ ] |
| 42 | DB 에러 | DB 장애 상황 시뮬레이션 | 에러 메시지 표시, 상태 롤백 | [ ] |

---

## 7. 성능 및 최적화

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 43 | 초기 로딩 | 페이지 로드 시 | isWatching 자동 호출, 상태 표시 | [ ] |
| 44 | 중복 요청 방지 | 빠르게 버튼 연타 | disabled로 중복 요청 방지 | [ ] |
| 45 | revalidatePath 동작 | 구독/해제 후 | 페이지 데이터 자동 갱신 | [ ] |

---

## 8. 접근성 (a11y)

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 46 | 키보드 접근 | Tab 키로 버튼 포커스 | 포커스 상태 명확히 표시 | [ ] |
| 47 | Enter/Space 동작 | 포커스 후 Enter/Space | 버튼 클릭 동작 실행 | [ ] |
| 48 | title 속성 | 버튼에 title 확인 | "알림 받기" / "알림 중지" 표시 | [ ] |

---

## 9. 빌드 및 타입 체크

| # | 테스트 항목 | 테스트 절차 | 예상 결과 | 통과 |
|---|------------|------------|----------|------|
| 49 | 빌드 성공 | `npm run build` 실행 | 에러 없이 빌드 완료 | [ ] |
| 50 | 타입 오류 없음 | TypeScript 컴파일 확인 | 타입 오류 없음 | [ ] |

---

## 테스트 결과 요약

- **총 테스트 항목**: 50개
- **자동 검증 완료**: 0개
- **수동 테스트 필요**: 50개

---

## 테스터 서명

- 테스트 일시:
- 테스터:
- 결과:

---

## 참고 사항

### DB 초기화 (필요 시)

```bash
# Docker 컨테이너 재시작
sudo docker-compose down
sudo docker-compose up -d --build

# 또는 psql로 테이블 재생성
psql postgresql://apihub:apihub_password@localhost:7000/apihub < init.sql
```

### 테스트 URL

- **로컬**: http://localhost:3005
- **원격 서버**: http://<서버IP>:3005

### 주요 파일

- `init.sql` - endpoint_watchers 테이블 스키마
- `src/app/actions/watch.ts` - Watch 서버 액션
- `src/components/WatchButton.tsx` - Watch 버튼 컴포넌트
- `src/components/ApiList.tsx` - 통합된 엔드포인트 리스트
